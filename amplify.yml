```yaml
version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Installing dependencies..."
        - sudo yum update -y
        # Use --best --allowerasing to resolve curl conflicts
        - sudo yum install -y curl tar python3-pip --best --allowerasing
        - echo "Installing Go..."
        - curl -OL https://go.dev/dl/go1.22.2.linux-amd64.tar.gz
        - sudo tar -C /usr/local -xzf go1.22.2.linux-amd64.tar.gz
        - export PATH=$PATH:/usr/local/go/bin
        - go version
        - echo "Installing Hugo..."
        - curl -L https://github.com/gohugoio/hugo/releases/download/v0.123.7/hugo_extended_0.123.7_Linux-64bit.tar.gz -o hugo.tar.gz
        - tar -xzf hugo.tar.gz
        - mkdir -p ~/.local/bin
        - mv hugo ~/.local/bin/
        - export PATH=~/.local/bin:$PATH
        - rm hugo.tar.gz
        - echo "Installing AWS CLI..."
        - pip install --upgrade awscli
        # Ensure content and static directories exist
        - mkdir -p content/chinese/blog/post content/chinese/casestudies static/images/blog static/images/gallery
        # Sync content from S3 bucket with error handling
        - if ! aws s3 sync s3://itsquarewebsite1/content/ content/chinese/ --delete; then
            echo "S3 content sync failed for content/";
            exit 1;
          fi
        - if ! aws s3 sync s3://itsquareweb/static/images/blog/ static/images/blog/ --delete; then
            echo "S3 images sync failed for blog images";
            exit 1;
          fi
        # Create static/images/gallery to prevent shortcode error
        - if ! aws s3 sync s3://itsquareweb/static/images/gallery/ static/images/gallery/ --delete; then
            echo "S3 images sync for gallery not found, creating empty directory";
            mkdir -p static/images/gallery;
          fi
        # Optional: Install new theme (e.g., Hugo Book) for migration
        - echo "Installing new Hugo theme (hugo-book)..."
        - git clone https://github.com/alex-shpak/hugo-book themes/hugo-book || echo "Hugo Book theme already exists"
        # Optional: Run content migration script (if provided)
        - if [ -f "hugo_theme_migration.py" ]; then
            echo "Running content migration script...";
            pip install boto3 pyyaml;
            python hugo_theme_migration.py;
            mv new_theme_content/* content/;
          fi
    build:
      commands:
        - export PATH=$PATH:/usr/local/go/bin
        - echo "Building Hugo site..."
        # Use new theme (e.g., hugo-book) if migration script ran
        - if [ -d "themes/hugo-book" ]; then
            ~/.local/bin/hugo --minify --gc --theme hugo-book;
          else
            ~/.local/bin/hugo --minify --gc;
          fi
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - static/images/**/*
      - content/chinese/**/*
      - ~/.local/bin/hugo
      - /usr/local/go/bin/go
      - themes/hugo-book/**/*
```